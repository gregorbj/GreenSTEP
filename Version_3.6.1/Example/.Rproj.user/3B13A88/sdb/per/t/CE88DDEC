{
    "collab_server" : "",
    "contents" : "#========================\n#GreenSTEP_Hh_Synthesis.r\n#========================\n#Copyright 2009 - 2016, Oregon Department of Transportation\n#Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use\n#this file except in compliance with the License. You may obtain a copy of the\n#License at\n#http://www.apache.org/licenses/LICENSE-2.0\n#Unless required by applicable law or agreed to in writing, software distributed\n#under the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n#CONDITIONS OF ANY KIND, either express or implied.  See the License for the\n#specific language governing permissions and limitations under the License.\n#Version: 3.5\n#Date: 12/5/16\n\n#Description\n#===========\n#This script takes population projections by age cohort, county and year and\n#makes synthetic households that are used in the GreenSTEP model. The attributes\n#of the synthetic households include the number of persons by age category. It\n#then adds other household attributes including household income, development\n#type (metropolitan, town, rural), population density of the neighborhood where\n#the household is located, urban character of the neighborhood, driver age\n#population, and whether the household has only elderly persons. The synthetic\n#household files are saved in the SynHsld folder. Synthetic households will not\n#be created if they already exist.\n\n#Create synthetic households for each forecast year and county\n#=============================================================\nlocal({\n  # Create a directory to store the created households if one does not exist\n  HsldDir <- paste(ModelDir, \"SynHsld\", sep = \"/\")\n  if (!file.exists(HsldDir))\n    dir.create(HsldDir)\n  # Run rest of script if synthetic households have not already been created\n  # Check is based on whether directory has been created\n  YearDir <- paste(HsldDir, \"/Year\", yr, sep = \"\")\n  if (file.exists(YearDir)) {\n    print(\n      paste(\n        \"The directory '\",\n        YearDir,\n        \"' already exists. Stopping synthetic household generation for \",\n        yr,\n        \".\",\n        sep = \"\"\n      )\n    )\n  } else {\n    # Create directory to store results\n    dir.create(YearDir)\n    \n    #Set a random seed to make run replicable\n    #========================================\n    #If the UsedSavedRandomSeed input parameter is TRUE a saved random seed will be retrieved\n    #Otherwise a new random seed will be set and saved\n    RandomSeedFile <-\n      paste(ModelDir, \"/RandomSeedValue\", yr, \".RData\", sep = \"\")\n    if (UseSavedRandomSeed & file.exists(RandomSeedFile)) {\n      RandomSeedValue <- assignLoad(RandomSeedFile)\n    } else {\n      RandomSeedValue <- sample(1:1000000, 1)\n      save(RandomSeedValue, file = RandomSeedFile)\n    }\n    #Set random seed for model run\n    set.seed(RandomSeedValue)\n    \n    #Create synthetic households for each county\n    #===========================================\n    # Load the population file for the year and put in order\n    PopFileName <-\n      paste(ModelDir,\n            \"/pop_forecasts/\",\n            \"pop_by_age_\",\n            yr,\n            \".csv\",\n            sep = \"\")\n    Pop..CoAp <- read.csv(PopFileName, row.names = 1)[Co, Ap]\n    # Create a list to hold the results where each component of the list\n    # is a matrix of households (rows) with number of people by age group (columns) for a county\n    Hsld_Co.HhAp <- list()\n    # Create the synthetic households for each county\n    for (co in Co) {\n      # Create households for the county\n      Hsld_Co.HhAp[[co]] <-\n        createHhByAge(unlist(Pop..CoAp[co,]), HtProb.HtAp)[[1]]\n    }\n    # Save the county synthetic population outputs\n    Filename <- paste(YearDir, \"/Hsld_Co.HhAp.RData\", sep = \"\")\n    save(Hsld_Co.HhAp, file = Filename, compress = TRUE)\n    \n\n    #Exit else\n  }\n  \n  #Exit local function\n})\n",
    "created" : 1482006964684.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2589824681",
    "id" : "CE88DDEC",
    "lastKnownWriteTime" : 1482011146,
    "last_content_update" : 1482011146876,
    "path" : "~/GitHub/GreenSTEP/Version_3.6.1/Example/scripts/GreenSTEP_Hh_Synthesis.r",
    "project_path" : "scripts/GreenSTEP_Hh_Synthesis.r",
    "properties" : {
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}